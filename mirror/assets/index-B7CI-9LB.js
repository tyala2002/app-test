(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&d(h)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const r=document.getElementById("mirror-video"),C=document.getElementById("delay-slider"),O=document.getElementById("delay-value"),a=document.getElementById("btn-mirror"),l=document.getElementById("btn-guide"),m=document.getElementById("guidelines"),B=document.querySelector(".controls");let v=null;function M(){B.classList.remove("hidden"),T()}function R(){B.classList.add("hidden")}function T(){v&&clearTimeout(v),v=setTimeout(R,3e3)}document.addEventListener("mousemove",M);document.addEventListener("touchstart",M);document.addEventListener("click",M);T();let y=null,u=null,f=null,s=null,L=[],p=!1,E=5;function x(){const e=['video/webm; codecs="vp8"','video/webm; codecs="vp9"','video/mp4; codecs="avc1.42E01E, mp4a.40.2"',"video/mp4"];for(const t of e)if(MediaRecorder.isTypeSupported(t)&&MediaSource.isTypeSupported(t))return console.log("Supported MIME: "+t),t;return null}async function I(){try{console.log("Requesting camera..."),y=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}},audio:!1}),console.log("Camera access granted.");const e=x();if(!e){console.log("No supported MIME type found for MSE."),alert("Browser does not support required video formats."),r.srcObject=y,r.play();return}f=new MediaSource,r.src=URL.createObjectURL(f),f.addEventListener("sourceopen",()=>{console.log("MediaSource opened.");try{s=f.addSourceBuffer(e),s.mode="sequence",s.addEventListener("updateend",()=>{p=!1,w(),P()}),s.addEventListener("error",t=>console.error("SourceBuffer error: ",t)),D(e),r.play().then(()=>console.log("Video playing")).catch(t=>console.error("Auto-play failed",t))}catch(t){console.error("AddSourceBuffer failed: ",t)}})}catch(e){console.error("Error accessing camera: ",e),alert("Camera error: "+e.message)}}function D(e){try{u=new MediaRecorder(y,{mimeType:e}),u.ondataavailable=async t=>{if(t.data.size>0){const n=await t.data.arrayBuffer();L.push(n),w()}},u.onstart=()=>console.log("MediaRecorder started"),u.onerror=t=>console.error("MediaRecorder error: ",t.error),u.start(100)}catch(t){console.error("MediaRecorder init failed: ",t)}}function w(){if(!(!s||p||L.length===0)&&f.readyState==="open"){p=!0;try{s.appendBuffer(L.shift())}catch(e){console.error("Append error: ",e),p=!1}}}function P(){if(!s||s.updating)return;const e=E+10;r.currentTime>e}setInterval(()=>{if(!r||!r.buffered.length)return;const e=r.buffered.end(r.buffered.length-1),t=r.buffered.start(0);let n=e-E;if(n<t&&(n=t),Math.abs(r.currentTime-n)>.5)if(r.paused)r.currentTime=Math.max(0,n),r.play().catch(d=>console.log("Play error",d));else{const d=r.currentTime-n;if(Math.abs(d)>1)r.currentTime=n;else{let o=1-d*.5;o=Math.max(.5,Math.min(1.5,o)),r.playbackRate=o}}},500);C.addEventListener("input",e=>{const t=parseFloat(e.target.value);E=t,O.textContent=t.toFixed(1)});a.addEventListener("click",()=>{r.classList.toggle("no-mirror")?(a.textContent="Mirror: OFF",a.classList.remove("active")):(a.textContent="Mirror: ON",a.classList.add("active"))});l.addEventListener("click",()=>{m.classList.toggle("hidden")?(l.textContent="Guide: OFF",l.classList.remove("active")):(l.textContent="Guide: ON",l.classList.add("active"))});let c=!1,b=50,S=50;function g(e,t){const n=r.getBoundingClientRect();b=Math.max(0,Math.min(100,(e-n.left)/n.width*100)),S=Math.max(0,Math.min(100,(t-n.top)/n.height*100)),m.style.setProperty("--guide-x",b+"%"),m.style.setProperty("--guide-y",S+"%")}r.addEventListener("mousedown",e=>{m.classList.contains("hidden")||(c=!0,g(e.clientX,e.clientY),e.preventDefault())});document.addEventListener("mousemove",e=>{c&&(g(e.clientX,e.clientY),e.preventDefault())});document.addEventListener("mouseup",()=>{c=!1});r.addEventListener("touchstart",e=>{if(!m.classList.contains("hidden")&&e.touches.length===1){c=!0;const t=e.touches[0];g(t.clientX,t.clientY),e.preventDefault()}});document.addEventListener("touchmove",e=>{if(c&&e.touches.length===1){const t=e.touches[0];g(t.clientX,t.clientY),e.preventDefault()}});document.addEventListener("touchend",()=>{c=!1});I();
